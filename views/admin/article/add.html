<!DOCTYPE html>
<html lang="en">

{{template "admin/header.tpl" .}}

<body>

    <div id="wrapper">

        <!-- Navigation -->
        {{template "admin/nav.tpl"}}

        <div id="page-wrapper">
            <div class="row">
                <div class="col-lg-12">
                    <h1 class="page-header">文章管理-添加</h1>
                </div>
                
            </div>
            

  			    <div class="space-6"></div>
            <form role="form">
               <div class="form-group">
                 <label for="txtTitle">标题</label>
                 <input type="text" class="form-control" name="title" id="txtTitle" placeholder="标题">
               </div>
               <div class="form-group">
                 <label for="txtAbstract">摘要</label>
                 <textarea rows="3" class="form-control" name="abstract" id="txtAbstract" placeholder="摘要"></textarea>
               </div>
               <div class="form-group">
                 <label for="selectCategory">分类</label>
                 <select class="form-control" name="category" id="selectCategory"></select>
               </div>
               <div class="form-group">
                 <label for="txtTags">标签</label>
                 <input type="text" class="form-control" name="tags" id="txtTags" placeholder="标签">
               </div>
              <div class="form-group">
                 <label for="editor">内容</label>
                  <div id="editor">
                    <p></p>
                  </div>
              </div>
              
               <button type="submit" class="btn btn-default">提交</button>
            </form>

  		    </div>
      </div>
    
    {{template "admin/footer.tpl"}}
<script src="/static/back/lib/wangEditor-3.1.1/wangEditor.min.js"></script>
<script type="text/javascript">
  
  $(function () {
    var E = window.wangEditor
    var editor = new E('#editor')
    editor.customConfig.uploadImgServer = '/upload';
    editor.create();

    bindCategory();

    $('type[submit]').click(function(){
      var data=$('form').serialize();
      data.content = editor.txt.html();
      $.ajax({
        url:'admin/article/post',
        type:'post',
        dataType:'json',
        data:data,
        success:function(data){
          
        },
        error:function(error){
          console.log(error);
        }
      });
    });
  });
  //绑定分类
  var bindCategory = function(){
    $.ajax({
      url:'/admin/category/all',
      type:'get',
      dataType:'json',
      success:function(data){
        if(data && data.code == 200){
          for(var i in data.msg){
            $('#selectCategory').append('<option value="'+data.msg[i].Id+'">'+data.msg[i].Name+'</option>');
          }
        }
      },
      error:function(error){
        console.log(error);
      }
    });
  };      
</script>
</body>

</html>
